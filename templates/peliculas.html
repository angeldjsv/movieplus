{% extends "_base.html" %}

{% block content %}
<h1>Pel√≠culas!</h1>

{% if user.is_authenticated %}
<h3>Bienvenido, {{ user.username }}!</h3>
{% else %}
<h3>Bienvenido a MOVIE+! Por favor, <a href="{% url 'login' %}">inicia sesi√≥n</a> o <a href="{% url 'signup' %}">reg√≠strate</a>.</h3>
{% endif %}

<!-- üîç Formulario de filtros -->
<form method="get">
  <label for="genero">G√©nero:</label>
  <select name="genero" id="genero">
    <option value="">Todos</option>
    <option value="accion" {% if request.GET.genero == "accion" %}selected{% endif %}>Acci√≥n</option>
    <option value="comedia" {% if request.GET.genero == "comedia" %}selected{% endif %}>Comedia</option>
    <option value="drama" {% if request.GET.genero == "drama" %}selected{% endif %}>Drama</option>
    <option value="terror" {% if request.GET.genero == "terror" %}selected{% endif %}>Terror</option>
    <option value="ciencia_ficcion" {% if request.GET.genero == "ciencia_ficcion" %}selected{% endif %}>Ciencia Ficci√≥n</option>
    <option value="animacion" {% if request.GET.genero == "animacion" %}selected{% endif %}>Animaci√≥n</option>
    <option value="romance" {% if request.GET.genero == "romance" %}selected{% endif %}>Romance</option>
    <option value="documental" {% if request.GET.genero == "documental" %}selected{% endif %}>Documental</option>
    <option value="aventura" {% if request.GET.genero == "aventura" %}selected{% endif %}>Aventura</option>
    <option value="fantasia" {% if request.GET.genero == "fantasia" %}selected{% endif %}>Fantas√≠a</option>
    <option value="misterio" {% if request.GET.genero == "misterio" %}selected{% endif %}>Misterio</option>
    <option value="historia" {% if request.GET.genero == "historia" %}selected{% endif %}>Historia</option>
    <option value="musical" {% if request.GET.genero == "musical" %}selected{% endif %}>Musical</option>
    <option value="biografia" {% if request.GET.genero == "biografia" %}selected{% endif %}>Biograf√≠a</option>
    <option value="deporte" {% if request.GET.genero == "deporte" %}selected{% endif %}>Deporte</option>
    <option value="guerra" {% if request.GET.genero == "guerra" %}selected{% endif %}>Guerra</option>
  </select>

  <label for="decada">D√©cada:</label>
  <select name="decada" id="decada">
    <option value="">Todas</option>
    <option value="2020" {% if request.GET.decada == "2020" %}selected{% endif %}>2020s</option>
    <option value="2010" {% if request.GET.decada == "2010" %}selected{% endif %}>2010s</option>
    <option value="2000" {% if request.GET.decada == "2000" %}selected{% endif %}>2000s</option>
    <option value="1990" {% if request.GET.decada == "1990" %}selected{% endif %}>1990s</option>
    <option value="1980" {% if request.GET.decada == "1980" %}selected{% endif %}>1980s</option>
    <option value="1970" {% if request.GET.decada == "1970" %}selected{% endif %}>1970s</option>
  </select>

  <button type="submit">Filtrar</button>
</form>

<!-- üé¨ Lista de pel√≠culas filtradas -->
<p>Pel√≠culas:</p>
<ul>
    {% for pelicula in page_obj %}
    <li>
        <strong>{{ pelicula.titulo }}</strong> ({{ pelicula.anio_lanzamiento }}) - {{ pelicula.get_genero_display }}<br>
        {% if pelicula.imagen %}
        <img src="{{ pelicula.imagen.url }}" alt="{{ pelicula.titulo }}" style="max-width: 200px; height: auto;">
        {% else %}
            <p><em>Sin imagen disponible</em></p>
        {% endif %}
    </li>
    {% empty %}
        <li>No hay pel√≠culas registradas.</li>
    {% endfor %}
</ul>

<!-- üìÑ Controles de paginaci√≥n -->
<div class="pagination">
  {% if page_obj.has_previous %}
    <a href="?{% if request.GET.genero %}genero={{ request.GET.genero }}&{% endif %}{% if request.GET.decada %}decada={{ request.GET.decada }}&{% endif %}page={{ page_obj.previous_page_number }}">Anterior</a>
  {% endif %}

  <span>P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

  {% if page_obj.has_next %}
    <a href="?{% if request.GET.genero %}genero={{ request.GET.genero }}&{% endif %}{% if request.GET.decada %}decada={{ request.GET.decada }}&{% endif %}page={{ page_obj.next_page_number }}">Siguiente</a>
  {% endif %}
</div>


{% endblock %}